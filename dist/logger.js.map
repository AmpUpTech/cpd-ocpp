{"version":3,"sources":["../src/logger.js"],"names":["debug","LOGGER_URL","COUNT_MESSAGE_TO_STORE","Logger","sockets","messages","socket","push","console","info","send","command","message","length","slice","sendMessage","messageToSend","readyState","OPEN"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAAA;;;;AACA;;AAGA;;;;;;AAEA,IAAMA,SAAQ,8CAAd;;AAEO,IAAMC,kCAAa,SAAnB;;AAEP,IAAMC,yBAAyB,EAA/B;;IAEqBC,M;AACnB,oBAAc;AAAA;;AACZ,SAAKC,OAAL,GAAe,EAAf;AACA,SAAKC,QAAL,GAAgB,EAAhB;AACD;;;;8BAESC,M,EAAQ;AAChB,WAAKF,OAAL,CAAaG,IAAb,CAAkBD,MAAlB;AACAE,cAAQC,IAAR,CAAa,KAAb;AACAH,aAAOI,IAAP,CAAY,yBAAe,EAAEC,SAAS,SAAX,EAAsBN,UAAU,KAAKA,QAArC,EAAf,CAAZ;AACD;;;0BAEKO,O,EAAS;AACb,UAAI,OAAOA,OAAP,KAAmB,QAAvB,EAAiC;AAC/BA,kBAAU,yBAAeA,OAAf,CAAV;AACD;AACD,WAAKP,QAAL,CAAcE,IAAd,CAAmBK,OAAnB;AACA,UAAI,KAAKP,QAAL,CAAcQ,MAAd,GAAuBX,sBAA3B,EAAmD;AACjD,aAAKG,QAAL,GAAgB,KAAKA,QAAL,CAAcS,KAAd,CAAoB,KAAKT,QAAL,CAAcQ,MAAd,GAAuBX,sBAA3C,EAAmE,KAAKG,QAAL,CAAcQ,MAAjF,CAAhB;AACD;;AAEDb,aAAMY,OAAN;AACA,WAAKG,WAAL,CAAiB,EAAEJ,SAAS,SAAX,EAAsBC,gBAAtB,EAAjB;AACD;;;gCAEWI,a,EAAe;AACzB,UAAI,OAAOA,aAAP,KAAyB,QAA7B,EAAuC;AACrCA,wBAAgB,yBAAeA,aAAf,CAAhB;AACD;;AAHwB;AAAA;AAAA;;AAAA;AAKzB,wDAAmB,KAAKZ,OAAxB,4GAAiC;AAAA,cAAxBE,MAAwB;;AAC/B,cAAIA,OAAOW,UAAP,KAAsB,aAAUC,IAApC,EAA0C;AACxCZ,mBAAOI,IAAP,CAAYM,aAAZ;AACD;AACF;AATwB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAU1B;;;;;kBAnCkBb,M","file":"logger.js","sourcesContent":["import debugFn from 'debug';\nimport {\n  DEBUG_LIBNAME\n} from './constants';\nimport Websocket from 'ws';\n\nconst debug = debugFn(DEBUG_LIBNAME);\n\nexport const LOGGER_URL = '/logger';\n\nconst COUNT_MESSAGE_TO_STORE = 10;\n\nexport default class Logger {\n  constructor() {\n    this.sockets = [];\n    this.messages = [];\n  }\n\n  addSocket(socket) {\n    this.sockets.push(socket);\n    console.info('add');\n    socket.send(JSON.stringify({ command: 'history', messages: this.messages }));\n  }\n\n  debug(message) {\n    if (typeof message !== 'string') {\n      message = JSON.stringify(message);\n    }\n    this.messages.push(message);\n    if (this.messages.length > COUNT_MESSAGE_TO_STORE) {\n      this.messages = this.messages.slice(this.messages.length - COUNT_MESSAGE_TO_STORE, this.messages.length)\n    }\n\n    debug(message);\n    this.sendMessage({ command: 'message', message });\n  }\n\n  sendMessage(messageToSend) {\n    if (typeof messageToSend !== 'string') {\n      messageToSend = JSON.stringify(messageToSend);\n    }\n\n    for (let socket of this.sockets) {\n      if (socket.readyState === Websocket.OPEN) {\n        socket.send(messageToSend);\n      }\n    }\n  }\n}\n"]}